<!DOCTYPE html>
<html>
<head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script type="text/javascript" src="sidenav.js"></script>
<script type="text/javascript" src="verses.js"></script>
<script type="text/javascript" src="bookdata.js"></script>
<script type="application/json" class="js-hypothesis-config">
  {
    "theme": "clean"
  }
</script>
<script src="https://hypothes.is/embed.js" async></script>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="esv.css">
<link rel="stylesheet" type="text/css" href="sidenav.css">
</head>

<body>
<script>
  // This function, combined with the custom 404.html, turns this into a single-page app.
  // See https://www.smashingmagazine.com/2016/08/sghpa-single-page-app-hack-github-pages/
  (function(){
    var redirect = sessionStorage.redirect;
    delete sessionStorage.redirect;
    if (redirect && redirect != location.href) {
      history.replaceState(null, null, redirect);
    }
  })();
</script>
<div class="container">
  <div id="books" class="sidenav selectnav">
    <div class="content"></div>
  </div>
  <div id="chapters" class="sidenav selectnav">
    <a href="javascript:void(0)" class="closebtn" onclick="showBookSelectionView()">&times;</a>
    <div class="content"></div>
  </div>
  <div id="verses" class="sidenav">
    <a href="javascript:void(0)" class="closebtn" onclick="showChapterSelectionView()">&times;</a>
    <div id="bible-content" class="content">Verses!</div>
  </div>
</div>
<script type="text/javascript">

  var selectedBook = "";
  var selectedChapter = "";


  showBookSelectionView();


  function loadStateBasedOnPath(){
    var pathArray = window.location.pathname.substr(1).split('/');
    if (pathArray[0] == "") {
      // No path
      console.log("No path");
    } else if (pathArray.length == 1) {
      // Book specified
      selectedBook = pathArray[0];
      console.log("Book specified in URL: " + selectedBook);
    } else if (pathArray.length == 2) {
      // Book and Chapter specified
      selectedBook = pathArray[0];
      selectedChapter = pathArray[1];
      console.log("Book specified in URL: " + selectedBook);
    } else {
      // Display 404
      console.log("Invalid path");
    }
  }

  window.addEventListener('popstate', (event) => {
    loadStateBasedOnPath();
  });

  for (var bookname in bookdata) {
    console.log("Book " + bookname + " has " + bookdata[bookname] + " chapters");
    $( "#books .content" ).append( "<a class='bookname' id='" + bookname + "' onclick='showChapterSelectionView()'>" + bookname + "</a>");
  }

  function displayChapters(bookname) {
    $("a").remove('.chapter');
    for (var i = 1; i <= bookdata[bookname]; i++) { 
      $("#chapters .content").append( "<a class='chapter' onclick='showVersesView()'>" + i + "</a>");
    }
  }

  function formatBookName(bookname) {
    return bookname.replace(/ /g,"+")
  }

  $('body').on('click', '.bookname', function(e) {
    var bookname = $(e.target).text();
    selectedBook = bookname;
    history.pushState({}, '', '/' + formatBookName(bookname))
    displayChapters(bookname);
  });

  $('body').on('click', '.chapter', function(e) {
    var chapter = $(e.target).text();
    history.pushState({}, '', '/' + formatBookName(selectedBook) + '/' + chapter)
    getChapterFromEsv(selectedBook, chapter);
  });

</script>
</body>
</html> 
